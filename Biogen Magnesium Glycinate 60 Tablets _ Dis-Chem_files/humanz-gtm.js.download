(()=>{"use strict";const t="https://v11cf13hx0.execute-api.eu-west-1.amazonaws.com/pixel-prod/",e="v1.1",i="hmz",a="https://6ujl3qfhv7.execute-api.eu-west-1.amazonaws.com/default/external-logger";function r(){var t="";try{t=window.location.href||parent.location.href}catch(t){}return t}function n(t,e,i){var n={type:e,message:i,client_id:t,url:r()};try{fetch(a,{method:"POST",body:JSON.stringify(n),mode:"no-cors",headers:{"Content-Type":"application/json"}})}catch(t){}}function o(t,e){var i=void 0;try{if(e&&(e=e.toString().replace("#","")),e&&parseInt(e)==e){var a="aaaaaaaa-aaaa-4aaa-aaaa-aaaaaaaaaaaa",r=0,o=t+e;if(o.length<30){for(;r<o.length;)a=a.replace("a",o[r]),r++;i=a}}else n(t,"gtmPurchaseKey (else) - order id = "+e)}catch(i){n(t,"gtmPurchaseKey (exception) - order id = "+e)}return i}var s,c=new Uint8Array(16);function u(){if(!s&&!(s="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(c)}const d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,p=function(t){return"string"==typeof t&&d.test(t)};for(var h=[],l=0;l<256;++l)h.push((l+256).toString(16).substr(1));const m=function(t,e,i){var a=(t=t||{}).random||(t.rng||u)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e){i=i||0;for(var r=0;r<16;++r)e[i+r]=a[r];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!p(i))throw TypeError("Stringified UUID is invalid");return i}(a)};var v;function f(){return v}function g(){return localStorage.getItem("h-u-u")||null}(v=localStorage.getItem("h-u-i"))||(v=m(),localStorage.setItem("h-u-i",v));class y{constructor(t){var e,a,r;this.app_id=t,this.user_id=g(),this.utms=(e=i,a=null,r=[],location.search.substr(1).split("&").forEach((function(t){(r=t.split("="))[0].startsWith(e)&&(a||(a={}),a[r[0]]=decodeURIComponent(r[1]))})),a),this.setAppId(t),this.setCampaignId(),window.hzp=this,console.log("-I-")}sendEvent(i,a,n){a={event_name:i,event_id:n||m(),user_id:g()||this.user_id,app_id:localStorage.getItem("h-u-a")||this.app_id,humanz_id:f(),source_url:r(),extra_data:a,version:e},fetch(t,{method:"POST",body:JSON.stringify(a),mode:"no-cors",headers:{"Content-Type":"application/json"}})}setCampaignId(){this.utms&&this.sendEvent("campaign",{utms:this.utms})}setAppId(t){!function(t){localStorage.setItem("h-u-a",t)}(t),this.sendEvent("initial")}makePurchase(t){var e=[];t.forEach((t=>{var i=t.name?decodeURI(t.name):void 0,a=t.coupon?decodeURI(t.coupon):void 0,r={type:"purchased_item",name:i,price:t.price,sku:t.sku||t.product_id||t.id||void 0,coupon:a,influencer:t.influencer||void 0,quantity:parseInt(t.quantity)||void 0,original:JSON.stringify(t)};e.push(r)}));var i={cart:e,utms:this.utms};this.sendEvent("purchase",i)}login(t){try{this.user_id=t,function(t){localStorage.setItem("h-u-u",t)}(t),this.sendEvent("user_login")}catch(t){}}logout(){try{this.user_id=null,localStorage.removeItem("h-u-u"),this.sendEvent("user_logout")}catch(t){}}getHumanzId(){return f()}addToCart(t=[]){var e=[];t.forEach((t=>{var i={type:"add_to_cart",name:t.name?decodeURI(t.name):void 0,price:parseFloat(t.price)||0,sku:t.sku||t.product_id||t.id||void 0,id:t.id||void 0,quantity:parseInt(t.quantity)||0,original:JSON.stringify(t),brand:t.brand||void 0};e.push(i)}));var i={products:e,utms:this.utms};this.sendEvent("add_to_cart",i)}}const _=y;window.hzi=y,window.initHmz=t=>{new window.hzi(t)},window.hzi=class extends _{constructor(t){super(t),window.hzp=this}gtmPurchase(t,e){try{if(t&&"object"==typeof t&&t.length){var i=[],a=void 0;if(e&&"string"==typeof e&&(a=e),window?.dataLayer?.length>0){var r=window.dataLayer.filter((t=>t?.ecommerce)).map((t=>t?.ecommerce?.purchase?.actionField?.id)).filter((t=>!!t));if(r?.length>0)return void this.gtmPurchaseKey(t,e,r[0])}var o=0,s={};t.forEach((t=>{var e=t.sku||t.product_id||t.id||void 0,r=t.price||0,n=parseInt(t.quantity)||1,c=(e+"_"+r).toString();if(s[c]&&s[c].price===r){var u=s[c].index;i[u]&&(i[u].quantity+=n)}else{var d={type:"purchased_item",name:t.name,price:r,sku:e,coupon:t.coupon||a||void 0,influencer:t.influencer||void 0,quantity:n,brand:t.brand||void 0,original:JSON.stringify(t)};i.push(d),s[c]={price:r,index:o},o++}}));var c={cart:i,utms:this.utms};this.sendEvent("purchase",c)}else n(this.app_id,"gtm_invalid_items",JSON.stringify(t))}catch(e){n(this.app_id,"gtm_exception",JSON.stringify(t))}}gtmPurchaseT(t,e,i){this.gtmPurchaseKey(t,e,i)}gtmPurchaseKey(t,e,i){try{if(t&&"object"==typeof t&&t.length){var a=[],r=void 0;e&&"string"==typeof e&&(r=e),i&&(i=i.toString().replace("#",""));var s=0,c={};t.forEach((t=>{var e=t.sku||t.product_id||t.id||void 0,i=t.price||0,n=parseInt(t.quantity)||1,o=(e+"_"+i).toString();if(c[o]&&c[o].price===i){var u=c[o].index;a[u]&&(a[u].quantity+=n)}else{var d={type:"purchased_item",name:t.name,price:i,sku:e,coupon:t.coupon||r||void 0,influencer:t.influencer||void 0,quantity:n,brand:t.brand||void 0,original:JSON.stringify(t)};a.push(d),c[o]={price:i,index:s},s++}}));var u={cart:a,transaction_id:i,utms:this.utms},d=o(this.app_id,i);this.sendEvent("purchase",u,d)}else n(this.app_id,"gtm_invalid_items",JSON.stringify(t))}catch(e){n(this.app_id,"gtm_exception",JSON.stringify(t))}}gtmPurchaseRevenue(t,e,i,a){try{if(t&&"object"==typeof t&&t.length){var r=[],s=void 0;e&&"string"==typeof e&&(s=e),i&&(i=i.toString().replace("#",""));var c=0,u={},d=0;t.forEach((t=>{var e=t.sku||t.product_id||t.id||void 0,i=t.price||0,a=parseInt(t.quantity)||1,o=(e+"_"+i).toString();try{d+=i*a}catch(t){d=Number.MIN_SAFE_INTEGER,n(this.app_id,"gtmPurchaseKey_total_price",JSON.stringify(r[p]))}if(u[o]&&u[o].price===i){var p=u[o].index;r[p]&&(r[p].quantity+=a)}else{var h={type:"purchased_item",name:t.name,price:i,sku:e,coupon:t.coupon||s||void 0,influencer:t.influencer||void 0,quantity:a,original:JSON.stringify(t)};r.push(h),u[o]={price:i,index:c},c++}}));try{if(d>a)for(var p=1-(d-a)/d,h=0;h<r.length;h++)r[h].price=Math.round(r[h].price*p*100)/100}catch(t){}var l={cart:r,transaction_id:i,utms:this.utms,revenue:a},m=o(this.app_id,i);this.sendEvent("purchase",l,m)}else n(this.app_id,"gtm_invalid_items",JSON.stringify(t))}catch(e){n(this.app_id,"gtm_exception",JSON.stringify(t))}}}})();